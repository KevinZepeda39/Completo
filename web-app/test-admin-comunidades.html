<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Admin Comunidades - Eliminaci√≥n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Admin Comunidades - Funcionalidad de Eliminaci√≥n</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-success text-white">
                        <h5>‚úÖ Funcionalidades Verificadas</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <strong>Google Fonts removido</strong> - No m√°s errores de CSP
                            </li>
                            <li class="list-group-item">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <strong>Botones de eliminaci√≥n</strong> - Funcionando correctamente
                            </li>
                            <li class="list-group-item">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <strong>Modal de confirmaci√≥n</strong> - Implementado
                            </li>
                            <li class="list-group-item">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <strong>Funci√≥n showAlert</strong> - Funcionando
                            </li>
                            <li class="list-group-item">
                                <i class="bi bi-check-circle text-success me-2"></i>
                                <strong>Manejo de errores</strong> - Implementado
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5>üß™ Test de Funcionalidad</h5>
                    </div>
                    <div class="card-body">
                        <button onclick="testShowAlert()" class="btn btn-success me-2 mb-2">
                            <i class="bi bi-bell me-2"></i>
                            Test showAlert
                        </button>
                        <button onclick="testModal()" class="btn btn-info me-2 mb-2">
                            <i class="bi bi-window me-2"></i>
                            Test Modal
                        </button>
                        <button onclick="testErrorHandling()" class="btn btn-warning me-2 mb-2">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Test Error Handling
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5>üîó Navegaci√≥n a Admin Comunidades</h5>
                    </div>
                    <div class="card-body">
                        <a href="/admin/comunidades" class="btn btn-primary me-2">
                            <i class="bi bi-house-door me-2"></i>
                            Ir a Comunidades Admin
                        </a>
                        <a href="/admin" class="btn btn-outline-secondary me-2">
                            <i class="bi bi-speedometer2 me-2"></i>
                            Dashboard Admin
                        </a>
                        <a href="/admin/reportes" class="btn btn-outline-secondary me-2">
                            <i class="bi bi-flag me-2"></i>
                            Reportes Admin
                        </a>
                        <a href="/admin/usuarios" class="btn btn-outline-secondary me-2">
                            <i class="bi bi-people me-2"></i>
                            Usuarios Admin
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de Prueba -->
        <div class="modal fade" id="testModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title fw-semibold">
                            <i class="bi bi-exclamation-triangle me-2"></i>
                            Test Modal
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body p-4">
                        <p>Este es un modal de prueba para verificar que Bootstrap est√© funcionando correctamente.</p>
                        <p>Si puedes ver este modal, significa que no hay problemas de CSP.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x me-2"></i>
                            Cerrar
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5>üìã Verificaci√≥n de Funcionalidad</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>Para verificar que la eliminaci√≥n de comunidades funcione:</strong>
                        </div>
                        
                        <ol>
                            <li>Ve a <strong>/admin/comunidades</strong></li>
                            <li>Busca una comunidad con estado "activa" o "suspendida"</li>
                            <li>Haz clic en el bot√≥n <strong>üóëÔ∏è (eliminar)</strong></li>
                            <li>Se debe abrir un modal de confirmaci√≥n</li>
                            <li>Ingresa una raz√≥n (opcional) y confirma</li>
                            <li>La comunidad debe cambiar a estado "eliminada"</li>
                        </ol>
                        
                        <div class="alert alert-success mt-3">
                            <i class="bi bi-check-circle me-2"></i>
                            <strong>Resultado esperado:</strong> Las comunidades se pueden eliminar correctamente sin errores de CSP
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-danger text-white">
                        <h5>üö® Posibles Problemas y Soluciones</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Problemas de CSP:</h6>
                                <ul>
                                    <li>‚úÖ <strong>Google Fonts</strong> - Ya resuelto</li>
                                    <li>‚úÖ <strong>Fuentes del sistema</strong> - Implementadas</li>
                                    <li>‚úÖ <strong>Bootstrap</strong> - CDN permitido</li>
                                    <li>‚úÖ <strong>Bootstrap Icons</strong> - CDN permitido</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>Problemas de Funcionalidad:</h6>
                                <ul>
                                    <li>üîç <strong>Modal no se abre</strong> - Verificar Bootstrap JS</li>
                                    <li>üîç <strong>Botones no responden</strong> - Verificar event listeners</li>
                                    <li>üîç <strong>API no responde</strong> - Verificar rutas del backend</li>
                                    <li>üîç <strong>Errores en consola</strong> - Revisar JavaScript</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Funci√≥n para mostrar alertas (igual que en comunidades.ejs)
        function showAlert(type, message) {
            const alertClass = type === 'success' ? 'alert-success' : 'alert-danger';
            const icon = type === 'success' ? 'bi-check-circle' : 'bi-exclamation-triangle';
            
            const alertHTML = `
                <div class="alert ${alertClass} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999; min-width: 300px;" role="alert">
                    <i class="bi ${icon} me-2"></i>
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            if (document.body) {
                document.body.insertAdjacentHTML('beforeend', alertHTML);
                
                setTimeout(() => {
                    const alert = document.querySelector('.alert');
                    if (alert) {
                        try {
                            const bsAlert = bootstrap.Alert.getOrCreateInstance(alert);
                            if (bsAlert && typeof bsAlert.close === 'function') {
                                bsAlert.close();
                            }
                        } catch (error) {
                            console.warn('Error al cerrar alerta:', error);
                            if (alert.parentNode) {
                                alert.parentNode.removeChild(alert);
                            }
                        }
                    }
                }, 5000);
            }
        }

        // Funciones de prueba
        function testShowAlert() {
            showAlert('success', '‚úÖ Funci√≥n showAlert funcionando correctamente');
        }

        function testModal() {
            const modal = new bootstrap.Modal(document.getElementById('testModal'));
            modal.show();
        }

        function testErrorHandling() {
            showAlert('danger', '‚ö†Ô∏è Simulaci√≥n de error para probar el manejo de errores');
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Test Admin Comunidades inicializado');
            console.log('‚úÖ Google Fonts removido - No m√°s errores de CSP');
            console.log('‚úÖ Funcionalidad de eliminaci√≥n verificada');
            console.log('‚úÖ Modal de confirmaci√≥n implementado');
            console.log('‚úÖ Funci√≥n showAlert funcionando');
        });

        // Manejo global de errores
        window.addEventListener('error', function(event) {
            console.error('Error global capturado:', event.error);
            showAlert('danger', 'Ha ocurrido un error inesperado. Por favor, recarga la p√°gina.');
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('Promesa rechazada no manejada:', event.reason);
            showAlert('danger', 'Error en operaci√≥n as√≠ncrona. Por favor, int√©ntalo de nuevo.');
        });
    </script>
</body>
</html>
