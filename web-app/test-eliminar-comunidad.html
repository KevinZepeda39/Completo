<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Eliminar Comunidad</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Eliminar Comunidad</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test API Eliminar Comunidad</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="comunidadId" class="form-label">ID de Comunidad:</label>
                            <input type="number" class="form-control" id="comunidadId" value="69" placeholder="ID de la comunidad a eliminar">
                        </div>
                        
                        <div class="mb-3">
                            <label for="razon" class="form-label">Raz√≥n (opcional):</label>
                            <textarea class="form-control" id="razon" rows="3" placeholder="Raz√≥n de la eliminaci√≥n"></textarea>
                        </div>
                        
                        <button type="button" class="btn btn-danger" onclick="testEliminarComunidad()">
                            <i class="bi bi-trash me-2"></i>
                            Test Eliminar Comunidad
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Resultado</h5>
                    </div>
                    <div class="card-body">
                        <div id="resultado" class="alert alert-info">
                            Haz clic en el bot√≥n para probar la eliminaci√≥n
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testEliminarComunidad() {
            const comunidadId = document.getElementById('comunidadId').value;
            const razon = document.getElementById('razon').value;
            const resultadoDiv = document.getElementById('resultado');
            
            if (!comunidadId) {
                resultadoDiv.className = 'alert alert-danger';
                resultadoDiv.innerHTML = '‚ùå Por favor ingresa un ID de comunidad';
                return;
            }
            
            resultadoDiv.className = 'alert alert-warning';
            resultadoDiv.innerHTML = '<i class="bi bi-arrow-clockwise spin me-2"></i>Procesando...';
            
            try {
                console.log('üîç Enviando request DELETE a:', `/admin/comunidades/${comunidadId}`);
                
                const response = await fetch(`/admin/comunidades/${comunidadId}`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        razon: razon
                    })
                });
                
                console.log('üîç Response recibida:', response);
                console.log('üîç Status:', response.status);
                console.log('üîç Headers:', response.headers);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üîç Data recibida:', data);
                
                if (data.success) {
                    resultadoDiv.className = 'alert alert-success';
                    resultadoDiv.innerHTML = `‚úÖ ${data.mensaje}`;
                } else {
                    resultadoDiv.className = 'alert alert-danger';
                    resultadoDiv.innerHTML = `‚ùå Error: ${data.error}`;
                }
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                resultadoDiv.className = 'alert alert-danger';
                resultadoDiv.innerHTML = `‚ùå Error de conexi√≥n: ${error.message}`;
            }
        }
        
        // Funci√≥n para hacer spin del √≠cono
        document.addEventListener('DOMContentLoaded', function() {
            const style = document.createElement('style');
            style.textContent = `
                .spin {
                    animation: spin 1s linear infinite;
                }
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        });
    </script>
</body>
</html>
